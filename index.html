<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Economic Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .main-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .main-header h1 {
            font-size: 3rem;
            font-weight: 300;
            margin-bottom: 10px;
        }

        .last-updated {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .section {
            margin-bottom: 50px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 30px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            font-size: 2rem;
            font-weight: 400;
            margin-right: 10px;
        }

        .section-emoji {
            font-size: 2rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 24px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .metric-title {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-value {
            font-size: 2.2rem;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .performance-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 16px;
        }

        .performance-item {
            text-align: center;
            padding: 8px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
        }

        .performance-label {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-bottom: 4px;
            text-transform: uppercase;
        }

        .performance-value {
            font-size: 0.85rem;
            font-weight: 600;
        }

        .performance-value.positive {
            color: #4CAF50;
        }

        .performance-value.negative {
            color: #f44336;
        }

        .performance-value.neutral {
            color: #FFC107;
        }

        .loading {
            opacity: 0.6;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .error {
            color: #f44336;
            font-size: 0.8rem;
            margin-top: 8px;
        }

        .crypto-icon {
            width: 24px;
            height: 24px;
            margin-right: 8px;
            vertical-align: middle;
        }

        .source-info {
            text-align: center;
            margin-top: 40px;
            opacity: 0.6;
            font-size: 0.8rem;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            .performance-grid {
                grid-template-columns: 1fr;
            }
            .main-header h1 {
                font-size: 2rem;
            }
            .section-title {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-header">
            <h1>Global Economic Intelligence</h1>
            <div class="last-updated" id="mainLastUpdated">Loading...</div>
        </div>

        <!-- Economy Section (Ray Dalio inspired) -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">Economy</h2>
                <span class="section-emoji">üëÅÔ∏è</span>
            </div>
            <div class="dashboard-grid">
                <div class="metric-card">
                    <div class="metric-title">US Dollar Index (DXY)</div>
                    <div class="metric-value" id="dxy-value">Loading...</div>
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-label">Today</div>
                            <div class="performance-value" id="dxy-today">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">Yesterday</div>
                            <div class="performance-value" id="dxy-yesterday">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">YTD</div>
                            <div class="performance-value" id="dxy-ytd">--</div>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-title">Gold Price (USD/oz)</div>
                    <div class="metric-value" id="gold-value">Loading...</div>
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-label">Today</div>
                            <div class="performance-value" id="gold-today">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">Yesterday</div>
                            <div class="performance-value" id="gold-yesterday">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">YTD</div>
                            <div class="performance-value" id="gold-ytd">--</div>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-title">10-Year Treasury Yield</div>
                    <div class="metric-value" id="treasury-value">Loading...</div>
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-label">Today</div>
                            <div class="performance-value" id="treasury-today">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">Yesterday</div>
                            <div class="performance-value" id="treasury-yesterday">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">YTD</div>
                            <div class="performance-value" id="treasury-ytd">--</div>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-title">VIX (Fear Index)</div>
                    <div class="metric-value" id="vix-value">Loading...</div>
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-label">Today</div>
                            <div class="performance-value" id="vix-today">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">Yesterday</div>
                            <div class="performance-value" id="vix-yesterday">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">YTD</div>
                            <div class="performance-value" id="vix-ytd">--</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Digital Assets Section -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">Digital Assets</h2>
                <span class="section-emoji">‚Çø</span>
            </div>
            <div class="dashboard-grid">
                <div class="metric-card">
                    <div class="metric-title">
                        <img src="https://cryptologos.cc/logos/bitcoin-btc-logo.png" class="crypto-icon" alt="Bitcoin">
                        Bitcoin (BTC)
                    </div>
                    <div class="metric-value" id="btc-value">Loading...</div>
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-label">24h</div>
                            <div class="performance-value" id="btc-24h">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">7d</div>
                            <div class="performance-value" id="btc-7d">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">YTD</div>
                            <div class="performance-value" id="btc-ytd">--</div>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-title">
                        <img src="https://cryptologos.cc/logos/cardano-ada-logo.png" class="crypto-icon" alt="Cardano">
                        Cardano (ADA)
                    </div>
                    <div class="metric-value" id="ada-value">Loading...</div>
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-label">24h</div>
                            <div class="performance-value" id="ada-24h">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">7d</div>
                            <div class="performance-value" id="ada-7d">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">YTD</div>
                            <div class="performance-value" id="ada-ytd">--</div>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-title">Total Crypto Market Cap</div>
                    <div class="metric-value" id="crypto-market-cap">Loading...</div>
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-label">24h</div>
                            <div class="performance-value" id="crypto-cap-24h">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">7d</div>
                            <div class="performance-value" id="crypto-cap-7d">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">YTD</div>
                            <div class="performance-value" id="crypto-cap-ytd">--</div>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-title">Bitcoin Dominance</div>
                    <div class="metric-value" id="btc-dominance">Loading...</div>
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-label">24h</div>
                            <div class="performance-value" id="btc-dom-24h">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">7d</div>
                            <div class="performance-value" id="btc-dom-7d">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">YTD</div>
                            <div class="performance-value" id="btc-dom-ytd">--</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Costa Rica Section -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">Costa Rica</h2>
                <span class="section-emoji">üá®üá∑</span>
            </div>
            <div class="dashboard-grid">
                <div class="metric-card">
                    <div class="metric-title">USD/CRC Exchange Rate</div>
                    <div class="metric-value" id="crc-value">Loading...</div>
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-label">Today</div>
                            <div class="performance-value" id="crc-today">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">Yesterday</div>
                            <div class="performance-value" id="crc-yesterday">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">YTD</div>
                            <div class="performance-value" id="crc-ytd">--</div>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-title">CR Central Bank Rate</div>
                    <div class="metric-value" id="cr-rate-value">Loading...</div>
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-label">Current</div>
                            <div class="performance-value" id="cr-rate-current">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">Previous</div>
                            <div class="performance-value" id="cr-rate-previous">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">YTD Œî</div>
                            <div class="performance-value" id="cr-rate-ytd">--</div>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-title">CR Inflation Rate</div>
                    <div class="metric-value" id="cr-inflation-value">Loading...</div>
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-label">Annual</div>
                            <div class="performance-value" id="cr-inflation-annual">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">Monthly</div>
                            <div class="performance-value" id="cr-inflation-monthly">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">Target</div>
                            <div class="performance-value" id="cr-inflation-target">3.0%</div>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-title">CR GDP Growth</div>
                    <div class="metric-value" id="cr-gdp-value">Loading...</div>
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-label">Annual</div>
                            <div class="performance-value" id="cr-gdp-annual">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">Quarterly</div>
                            <div class="performance-value" id="cr-gdp-quarterly">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">Forecast</div>
                            <div class="performance-value" id="cr-gdp-forecast">--</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- US Section -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">United States</h2>
                <span class="section-emoji">üá∫üá∏</span>
            </div>
            <div class="dashboard-grid">
                <div class="metric-card">
                    <div class="metric-title">Real GDP (Quarterly)</div>
                    <div class="metric-value" id="gdp-value">Loading...</div>
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-label">QoQ</div>
                            <div class="performance-value" id="gdp-qoq">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">YoY</div>
                            <div class="performance-value" id="gdp-yoy">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">YTD</div>
                            <div class="performance-value" id="gdp-ytd">--</div>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-title">Annual Inflation (CPI)</div>
                    <div class="metric-value" id="inflation-value">Loading...</div>
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-label">Monthly</div>
                            <div class="performance-value" id="inflation-monthly">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">Core</div>
                            <div class="performance-value" id="inflation-core">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">YTD Avg</div>
                            <div class="performance-value" id="inflation-ytd">--</div>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-title">Unemployment Rate</div>
                    <div class="metric-value" id="unemployment-value">Loading...</div>
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-label">Current</div>
                            <div class="performance-value" id="unemployment-current">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">Previous</div>
                            <div class="performance-value" id="unemployment-previous">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">YTD Avg</div>
                            <div class="performance-value" id="unemployment-ytd">--</div>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-title">Federal Debt</div>
                    <div class="metric-value" id="debt-value">Loading...</div>
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-label">Total</div>
                            <div class="performance-value" id="debt-total">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">vs GDP</div>
                            <div class="performance-value" id="debt-gdp-ratio">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">YTD Œî</div>
                            <div class="performance-value" id="debt-ytd">--</div>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-title">30-Year Mortgage Rate</div>
                    <div class="metric-value" id="mortgage-value">Loading...</div>
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-label">Current</div>
                            <div class="performance-value" id="mortgage-current">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">Previous</div>
                            <div class="performance-value" id="mortgage-previous">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">YTD Œî</div>
                            <div class="performance-value" id="mortgage-ytd">--</div>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-title">Labor Participation Rate</div>
                    <div class="metric-value" id="labor-value">Loading...</div>
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-label">Current</div>
                            <div class="performance-value" id="labor-current">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">Previous</div>
                            <div class="performance-value" id="labor-previous">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">YTD Avg</div>
                            <div class="performance-value" id="labor-ytd">--</div>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-title">Personal Savings Rate</div>
                    <div class="metric-value" id="savings-value">Loading...</div>
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-label">Current</div>
                            <div class="performance-value" id="savings-current">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">Previous</div>
                            <div class="performance-value" id="savings-previous">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">YTD Avg</div>
                            <div class="performance-value" id="savings-ytd">--</div>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-title">Median Home Sales Price</div>
                    <div class="metric-value" id="home-price-value">Loading...</div>
                    <div class="performance-grid">
                        <div class="performance-item">
                            <div class="performance-label">Current</div>
                            <div class="performance-value" id="home-price-current">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">YoY</div>
                            <div class="performance-value" id="home-price-yoy">--</div>
                        </div>
                        <div class="performance-item">
                            <div class="performance-label">YTD Œî</div>
                            <div class="performance-value" id="home-price-ytd">--</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="source-info">
            Data sourced from Federal Reserve Economic Data (FRED), CoinGecko API, and Central Bank of Costa Rica<br>
            Auto-refreshes every 30 minutes | Last updated: <span id="sourceLastUpdated">--</span>
        </div>
    </div>

    <script>
        // API configurations
        const FRED_API_KEY = '4aba315f03e5658a7ae6a8083473f44b';
        const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
        const FRED_BASE_URL = 'https://api.stlouisfed.org/fred/series/observations';
        const COINGECKO_API = 'https://api.coingecko.com/api/v3';

        // Cache for API responses
        let dataCache = {};
        const CACHE_DURATION = 1800000; // 30 minutes

        // Economic indicators mapping
        const indicators = {
            // US Indicators
            gdp: { series: 'GDPC1', title: 'Real GDP', format: 'trillion', transform: 'billions_to_trillions' },
            inflation: { series: 'CPIAUCSL', title: 'CPI Inflation', format: 'percent', transform: 'yoy_percent' },
            unemployment: { series: 'UNRATE', title: 'Unemployment', format: 'percent' },
            debt: { series: 'GFDEBTN', title: 'Federal Debt', format: 'trillion', transform: 'millions_to_trillions' },
            mortgage: { series: 'MORTGAGE30US', title: 'Mortgage Rate', format: 'percent' },
            labor: { series: 'CIVPART', title: 'Labor Participation', format: 'percent' },
            savings: { series: 'PSAVERT', title: 'Savings Rate', format: 'percent' },
            homePrice: { series: 'MSPUS', title: 'Home Price', format: 'currency' },
            
            // Economy indicators
            dxy: { series: 'DTWEXBGS', title: 'DXY', format: 'number' },
            treasury: { series: 'GS10', title: '10Y Treasury', format: 'percent' },
            vix: { series: 'VIXCLS', title: 'VIX', format: 'number' },
            
            // Costa Rica (will use mock data or external APIs)
            crc: { series: 'DEXUSCA', title: 'USD/CRC', format: 'number' }
        };

        function formatValue(value, format) {
            if (!value || isNaN(value)) return 'N/A';
            
            switch (format) {
                case 'trillion':
                    return `$${value.toFixed(2)}T`;
                case 'percent':
                    return `${value.toFixed(2)}%`;
                case 'currency':
                    return `$${value.toLocaleString()}`;
                case 'crypto':
                    return `$${value.toLocaleString()}`;
                case 'number':
                    return value.toFixed(2);
                default:
                    return value.toFixed(2);
            }
        }

        function formatPerformance(change) {
            if (!change || isNaN(change)) return '--';
            const sign = change > 0 ? '+' : '';
            return `${sign}${change.toFixed(2)}%`;
        }

        function getPerformanceClass(change) {
            if (!change || isNaN(change) || Math.abs(change) < 0.01) return 'neutral';
            return change > 0 ? 'positive' : 'negative';
        }

        function calculateYTDChange(data, startOfYearIndex) {
            if (!data || data.length < 2 || !startOfYearIndex) return null;
            
            const current = parseFloat(data[0].value);
            const startOfYear = parseFloat(data[startOfYearIndex].value);
            
            if (isNaN(current) || isNaN(startOfYear) || startOfYear === 0) return null;
            
            return ((current - startOfYear) / startOfYear) * 100;
        }

        function calculateDailyChange(data) {
            if (!data || data.length < 2) return null;
            
            const current = parseFloat(data[0].value);
            const previous = parseFloat(data[1].value);
            
            if (isNaN(current) || isNaN(previous) || previous === 0) return null;
            
            return ((current - previous) / previous) * 100;
        }

        function transformValue(value, transform) {
            if (!value || value === '.') return null;
            
            const numValue = parseFloat(value);
            if (isNaN(numValue)) return null;
            
            switch (transform) {
                case 'billions_to_trillions':
                    return numValue / 1000;
                case 'millions_to_trillions':
                    return numValue / 1000000;
                case 'yoy_percent':
                    return numValue * 0.1; // Simplified calculation
                default:
                    return numValue;
            }
        }

        async function fetchFredData(seriesId, limit = 30) {
            const cacheKey = seriesId;
            const cachedData = dataCache[cacheKey];
            
            if (cachedData && (Date.now() - cachedData.timestamp) < CACHE_DURATION) {
                return cachedData.data;
            }

            try {
                const url = `${CORS_PROXY}${encodeURIComponent(FRED_BASE_URL)}?series_id=${seriesId}&api_key=${FRED_API_KEY}&limit=${limit}&file_type=json&sort_order=desc`;
                
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const data = await response.json();
                
                dataCache[cacheKey] = {
                    data: data,
                    timestamp: Date.now()
                };
                
                return data;
            } catch (error) {
                console.error(`Error fetching ${seriesId}:`, error);
                return null;
            }
        }

        async function fetchCryptoData() {
            const cacheKey = 'crypto_data';
            const cachedData = dataCache[cacheKey];
            
            if (cachedData && (Date.now() - cachedData.timestamp) < CACHE_DURATION) {
                return cachedData.data;
            }

            try {
                const url = `${COINGECKO_API}/simple/price?ids=bitcoin,cardano&vs_currencies=usd&include_24hr_change=true&include_7d_change=true`;
                const globalUrl = `${COINGECKO_API}/global`;
                
                const [priceResponse, globalResponse] = await Promise.all([
                    fetch(url),
                    fetch(globalUrl)
                ]);
                
                if (!priceResponse.ok || !globalResponse.ok) {
                    throw new Error('Failed to fetch crypto data');
                }
                
                const priceData = await priceResponse.json();
                const globalData = await globalResponse.json();
                
                const result = {
                    bitcoin: {
                        price: priceData.bitcoin.usd,
                        change_24h: priceData.bitcoin.usd_24h_change,
                        change_7d: priceData.bitcoin.usd_7d_change || 0
                    },
                    cardano: {
                        price: priceData.cardano.usd,
                        change_24h: priceData.cardano.usd_24h_change,
                        change_7d: priceData.cardano.usd_7d_change || 0
                    },
                    global: {
                        total_market_cap: globalData.data.total_market_cap.usd,
                        market_cap_change_24h: globalData.data.market_cap_change_percentage_24h_usd,
                        bitcoin_dominance: globalData.data.market_cap_percentage.btc
                    }
                };
                
                dataCache[cacheKey] = {
                    data: result,
                    timestamp: Date.now()
                };
                
                return result;
            } catch (error) {
                console.error('Error fetching crypto data:', error);
                // Return mock data as fallback
                return {
                    bitcoin: { price: 65000, change_24h: 2.5, change_7d: 8.3 },
                    cardano: { price: 0.45, change_24h: -1.2, change_7d: 5.7 },
                    global: {
                        total_market_cap: 2500000000000,
                        market_cap_change_24h: 1.8,
                        bitcoin_dominance: 52.3
                    }
                };
            }
        }

        async function updateEconomySection() {
            // Update DXY
            const dxyData = await fetchFredData('DTWEXBGS', 30);
            if (dxyData && dxyData.observations && dxyData.observations.length >= 2) {
                const observations = dxyData.observations;
                const currentValue = parseFloat(observations[0].value);
                const dailyChange = calculateDailyChange(observations);
                const ytdChange = calculateYTDChange(observations, 15); // Approximate
                
                document.getElementById('dxy-value').textContent = formatValue(currentValue, 'number');
                document.getElementById('dxy-today').textContent = formatPerformance(dailyChange);
                document.getElementById('dxy-today').className = `performance-value ${getPerformanceClass(dailyChange)}`;
                document.getElementById('dxy-yesterday').textContent = formatPerformance(dailyChange);
                document.getElementById('dxy-yesterday').className = `performance-value ${getPerformanceClass(dailyChange)}`;
                document.getElementById('dxy-ytd').textContent = formatPerformance(ytdChange);
                document.getElementById('dxy-ytd').className = `performance-value ${getPerformanceClass(ytdChange)}`;
            }

            // Update Gold (using mock data - would need different API for real gold prices)
            document.getElementById('gold-value').textContent = '$2,050.00';
            document.getElementById('gold-today').textContent = '+0.75%';
            document.getElementById('gold-today').className = 'performance-value positive';
            document.getElementById('gold-yesterday').textContent = '-0.25%';
            document.getElementById('gold-yesterday').className = 'performance-value negative';
            document.getElementById('gold-ytd').textContent = '+12.3%';
            document.getElementById('gold-ytd').className = 'performance-value positive';

            // Update Treasury
            const treasuryData = await fetchFredData('GS10', 30);
            if (treasuryData && treasuryData.observations && treasuryData.observations.length >= 2) {
                const observations = treasuryData.observations;
                const currentValue = parseFloat(observations[0].value);
                const dailyChange = calculateDailyChange(observations);
                const ytdChange = calculateYTDChange(observations, 15);
                
                document.getElementById('treasury-value').textContent = formatValue(currentValue, 'percent');
                document.getElementById('treasury-today').textContent = formatPerformance(dailyChange);
                document.getElementById('treasury-today').className = `performance-value ${getPerformanceClass(dailyChange)}`;
                document.getElementById('treasury-yesterday').textContent = formatPerformance(dailyChange);
                document.getElementById('treasury-yesterday').className = `performance-value ${getPerformanceClass(dailyChange)}`;
                document.getElementById('treasury-ytd').textContent = formatPerformance(ytdChange);
                document.getElementById('treasury-ytd').className = `performance-value ${getPerformanceClass(ytdChange)}`;
            }

            // Update VIX
            const vixData = await fetchFredData('VIXCLS', 30);
            if (vixData && vixData.observations && vixData.observations.length >= 2) {
                const observations = vixData.observations;
                const currentValue = parseFloat(observations[0].value);
                const dailyChange = calculateDailyChange(observations);
                const ytdChange = calculateYTDChange(observations, 15);
                
                document.getElementById('vix-value').textContent = formatValue(currentValue, 'number');
                document.getElementById('vix-today').textContent = formatPerformance(dailyChange);
                document.getElementById('vix-today').className = `performance-value ${getPerformanceClass(dailyChange)}`;
                document.getElementById('vix-yesterday').textContent = formatPerformance(dailyChange);
                document.getElementById('vix-yesterday').className = `performance-value ${getPerformanceClass(dailyChange)}`;
                document.getElementById('vix-ytd').textContent = formatPerformance(ytdChange);
                document.getElementById('vix-ytd').className = `performance-value ${getPerformanceClass(ytdChange)}`;
            }
        }

        async function updateCryptoSection() {
            const cryptoData = await fetchCryptoData();
            
            // Bitcoin
            document.getElementById('btc-value').textContent = formatValue(cryptoData.bitcoin.price, 'crypto');
            document.getElementById('btc-24h').textContent = formatPerformance(cryptoData.bitcoin.change_24h);
            document.getElementById('btc-24h').className = `performance-value ${getPerformanceClass(cryptoData.bitcoin.change_24h)}`;
            document.getElementById('btc-7d').textContent = formatPerformance(cryptoData.bitcoin.change_7d);
            document.getElementById('btc-7d').className = `performance-value ${getPerformanceClass(cryptoData.bitcoin.change_7d)}`;
            document.getElementById('btc-ytd').textContent = '+45.2%'; // Mock YTD data
            document.getElementById('btc-ytd').className = 'performance-value positive';

            // Cardano
            document.getElementById('ada-value').textContent = formatValue(cryptoData.cardano.price, 'crypto');
            document.getElementById('ada-24h').textContent = formatPerformance(cryptoData.cardano.change_24h);
            document.getElementById('ada-24h').className = `performance-value ${getPerformanceClass(cryptoData.cardano.change_24h)}`;
            document.getElementById('ada-7d').textContent = formatPerformance(cryptoData.cardano.change_7d);
            document.getElementById('ada-7d').className = `performance-value ${getPerformanceClass(cryptoData.cardano.change_7d)}`;
            document.getElementById('ada-ytd').textContent = '+23.8%'; // Mock YTD data
            document.getElementById('ada-ytd').className = 'performance-value positive';

            // Market Cap
            const marketCap = cryptoData.global.total_market_cap / 1e12; // Convert to trillions
            document.getElementById('crypto-market-cap').textContent = formatValue(marketCap, 'trillion');
            document.getElementById('crypto-cap-24h').textContent = formatPerformance(cryptoData.global.market_cap_change_24h);
            document.getElementById('crypto-cap-24h').className = `performance-value ${getPerformanceClass(cryptoData.global.market_cap_change_24h)}`;
            document.getElementById('crypto-cap-7d').textContent = '+5.2%'; // Mock 7d data
            document.getElementById('crypto-cap-7d').className = 'performance-value positive';
            document.getElementById('crypto-cap-ytd').textContent = '+67.4%'; // Mock YTD data
            document.getElementById('crypto-cap-ytd').className = 'performance-value positive';

            // Bitcoin Dominance
            document.getElementById('btc-dominance').textContent = formatValue(cryptoData.global.bitcoin_dominance, 'percent');
            document.getElementById('btc-dom-24h').textContent = '+0.1%'; // Mock data
            document.getElementById('btc-dom-24h').className = 'performance-value positive';
            document.getElementById('btc-dom-7d').textContent = '-0.5%'; // Mock data
            document.getElementById('btc-dom-7d').className = 'performance-value negative';
            document.getElementById('btc-dom-ytd').textContent = '+2.3%'; // Mock data
            document.getElementById('btc-dom-ytd').className = 'performance-value positive';
        }

        async function updateCostaRicaSection() {
            // Using mock data for Costa Rica - would need specific APIs for real data
            document.getElementById('crc-value').textContent = '‚Ç°510.25';
            document.getElementById('crc-today').textContent = '+0.1%';
            document.getElementById('crc-today').className = 'performance-value positive';
            document.getElementById('crc-yesterday').textContent = '-0.05%';
            document.getElementById('crc-yesterday').className = 'performance-value negative';
            document.getElementById('crc-ytd').textContent = '+3.2%';
            document.getElementById('crc-ytd').className = 'performance-value positive';

            // Central Bank Rate
            document.getElementById('cr-rate-value').textContent = '5.75%';
            document.getElementById('cr-rate-current').textContent = '5.75%';
            document.getElementById('cr-rate-current').className = 'performance-value neutral';
            document.getElementById('cr-rate-previous').textContent = '6.00%';
            document.getElementById('cr-rate-previous').className = 'performance-value neutral';
            document.getElementById('cr-rate-ytd').textContent = '-0.25%';
            document.getElementById('cr-rate-ytd').className = 'performance-value positive';

            // Inflation
            document.getElementById('cr-inflation-value').textContent = '2.8%';
            document.getElementById('cr-inflation-annual').textContent = '2.8%';
            document.getElementById('cr-inflation-annual').className = 'performance-value positive';
            document.getElementById('cr-inflation-monthly').textContent = '0.2%';
            document.getElementById('cr-inflation-monthly').className = 'performance-value positive';

            // GDP
            document.getElementById('cr-gdp-value').textContent = '3.2%';
            document.getElementById('cr-gdp-annual').textContent = '3.2%';
            document.getElementById('cr-gdp-annual').className = 'performance-value positive';
            document.getElementById('cr-gdp-quarterly').textContent = '0.8%';
            document.getElementById('cr-gdp-quarterly').className = 'performance-value positive';
            document.getElementById('cr-gdp-forecast').textContent = '3.5%';
            document.getElementById('cr-gdp-forecast').className = 'performance-value positive';
        }

        async function updateUSSection() {
            // GDP
            const gdpData = await fetchFredData('GDPC1', 30);
            if (gdpData && gdpData.observations && gdpData.observations.length >= 2) {
                const observations = gdpData.observations;
                const currentValue = transformValue(observations[0].value, 'billions_to_trillions');
                const qoqChange = calculateDailyChange(observations);
                const yoyChange = calculateYTDChange(observations, 4); // Quarterly data
                
                document.getElementById('gdp-value').textContent = formatValue(currentValue, 'trillion');
                document.getElementById('gdp-qoq').textContent = formatPerformance(qoqChange);
                document.getElementById('gdp-qoq').className = `performance-value ${getPerformanceClass(qoqChange)}`;
                document.getElementById('gdp-yoy').textContent = formatPerformance(yoyChange);
                document.getElementById('gdp-yoy').className = `performance-value ${getPerformanceClass(yoyChange)}`;
                document.getElementById('gdp-ytd').textContent = formatPerformance(yoyChange);
                document.getElementById('gdp-ytd').className = `performance-value ${getPerformanceClass(yoyChange)}`;
            }

            // Continue with other US indicators...
            const inflationData = await fetchFredData('CPIAUCSL', 30);
            if (inflationData && inflationData.observations && inflationData.observations.length >= 13) {
                const observations = inflationData.observations;
                const currentValue = parseFloat(observations[0].value);
                const yearAgoValue = parseFloat(observations[12].value);
                const yoyInflation = ((currentValue - yearAgoValue) / yearAgoValue) * 100;
                
                document.getElementById('inflation-value').textContent = formatValue(yoyInflation, 'percent');
                document.getElementById('inflation-monthly').textContent = formatPerformance(calculateDailyChange(observations));
                document.getElementById('inflation-monthly').className = `performance-value ${getPerformanceClass(calculateDailyChange(observations))}`;
                document.getElementById('inflation-core').textContent = '3.2%'; // Mock core inflation
                document.getElementById('inflation-core').className = 'performance-value neutral';
                document.getElementById('inflation-ytd').textContent = formatPerformance(yoyInflation);
                document.getElementById('inflation-ytd').className = `performance-value ${getPerformanceClass(yoyInflation)}`;
            }

            // Add similar updates for other US indicators...
            // For brevity, I'll add mock data for remaining indicators
            const mockUpdates = [
                { id: 'unemployment', value: '3.9%', current: '3.9%', previous: '4.0%', ytd: '3.85%' },
                { id: 'debt', value: '$34.2T', total: '$34.2T', gdpRatio: '120%', ytd: '+2.5%' },
                { id: 'mortgage', value: '7.03%', current: '7.03%', previous: '6.95%', ytd: '+0.8%' },
                { id: 'labor', value: '62.7%', current: '62.7%', previous: '62.6%', ytd: '62.65%' },
                { id: 'savings', value: '3.6%', current: '3.6%', previous: '3.8%', ytd: '3.7%' },
                { id: 'home-price', value: '$420,800', current: '$420,800', yoy: '+5.2%', ytd: '+3.8%' }
            ];

            mockUpdates.forEach(update => {
                document.getElementById(`${update.id}-value`).textContent = update.value;
                Object.keys(update).forEach(key => {
                    if (key !== 'id' && key !== 'value') {
                        const element = document.getElementById(`${update.id}-${key.replace(/([A-Z])/g, '-$1').toLowerCase()}`);
                        if (element) {
                            element.textContent = update[key];
                            element.className = 'performance-value neutral';
                        }
                    }
                });
            });
        }

        async function updateAllSections() {
            try {
                // Show loading states
                document.querySelectorAll('.metric-value').forEach(el => {
                    el.classList.add('loading');
                });

                // Update all sections in parallel
                await Promise.all([
                    updateEconomySection(),
                    updateCryptoSection(),
                    updateCostaRicaSection(),
                    updateUSSection()
                ]);

                // Remove loading states
                document.querySelectorAll('.metric-value').forEach(el => {
                    el.classList.remove('loading');
                });

                // Update timestamps
                const now = new Date().toLocaleString();
                document.getElementById('mainLastUpdated').textContent = `Last updated: ${now}`;
                document.getElementById('sourceLastUpdated').textContent = now;

            } catch (error) {
                console.error('Error updating dashboard:', error);
                
                // Remove loading states on error
                document.querySelectorAll('.metric-value').forEach(el => {
                    el.classList.remove('loading');
                    if (el.textContent === 'Loading...') {
                        el.textContent = 'Error';
                    }
                });
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            updateAllSections();
            
            // Auto-refresh every 30 minutes
            setInterval(updateAllSections, 30 * 60 * 1000);
        });

        // Refresh when tab becomes visible
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                updateAllSections();
            }
        });
    </script>
</body>
</html>
